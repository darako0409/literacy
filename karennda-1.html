<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ» ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }
        .day-cell {
            min-height: 110px;
            border: 0.5px solid #f1f5f9;
            padding: 6px;
            cursor: pointer;
            transition: all 0.2s;
            background-color: white;
            display: flex;
            flex-direction: column;
        }
        .day-cell:hover {
            background-color: #f1f5f9;
        }
        .day-cell.prev-month, .day-cell.next-month {
            background-color: #f8fafc;
            color: #cbd5e1;
        }
        .day-cell.today {
            background-color: #eff6ff;
            border: 2px solid #3b82f6;
            z-index: 10;
        }
        .day-number {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .holiday { color: #ef4444; }
        .saturday { color: #3b82f6; }

        /* äºˆå®šãƒ»TODOã‚¢ã‚¤ãƒ†ãƒ  */
        .item-badge {
            font-size: 0.7rem;
            padding: 1px 4px;
            border-radius: 4px;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.2;
        }
        .item-badge.event {
            background-color: #e2e8f0;
            color: #475569;
            font-weight: 600;
        }
        .item-badge.todo {
            background-color: #dcfce7;
            color: #166534;
        }
        .item-badge.completed {
            text-decoration: line-through;
            opacity: 0.5;
            background-color: #f1f5f9;
            color: #94a3b8;
        }

        /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œï¼ˆã‚¹ãƒãƒ›è¡¨ç¤ºæ™‚ï¼‰ */
        .calendar-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .mobile-layout .calendar-grid {
            min-width: 600px;
        }
        .mobile-layout .day-cell {
            min-height: 80px;
        }

        /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¹… */
        .pc-layout .main-content {
            max-width: 1000px;
        }
        .mobile-layout .main-content {
            max-width: 100%;
        }
        
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼éè¡¨ç¤ºï¼ˆä»»æ„ï¼‰ */
        .calendar-wrapper::-webkit-scrollbar {
            height: 4px;
        }
        .calendar-wrapper::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
    </style>
</head>
<body class="p-2 sm:p-4 pc-layout">

    <!-- è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ -->
    <div class="flex justify-center mb-6 space-x-2">
        <button id="mobileViewBtn" class="px-4 py-2 text-sm font-bold rounded-full border transition-all bg-white text-gray-600 border-gray-200">ã‚¹ãƒãƒ›è¡¨ç¤º</button>
        <button id="pcViewBtn" class="px-4 py-2 text-sm font-bold rounded-full border transition-all bg-blue-600 text-white border-blue-600 shadow-sm">PCè¡¨ç¤º</button>
    </div>

    <div class="main-content mx-auto space-y-6">
        
        <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚«ãƒ¼ãƒ‰ -->
        <div class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="p-4 sm:p-6 flex items-center justify-between border-b border-gray-50">
                <h1 class="text-2xl font-black text-gray-800">ğŸŒ»</h1>
                <div class="flex items-center space-x-4">
                    <button id="prevMonthBtn" class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 rounded-full font-bold text-gray-500">&lt;</button>
                    <span id="currentMonthYear" class="text-lg font-bold text-gray-700 min-w-[100px] text-center"></span>
                    <button id="nextMonthBtn" class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 rounded-full font-bold text-gray-500">&gt;</button>
                </div>
            </div>

            <div class="calendar-wrapper">
                <!-- æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                <div class="calendar-grid bg-gray-50 text-center py-2 text-[10px] font-bold text-gray-400 uppercase tracking-widest border-b border-gray-100">
                    <div class="holiday">SUN</div>
                    <div>MON</div>
                    <div>TUE</div>
                    <div>WED</div>
                    <div>THU</div>
                    <div>FRI</div>
                    <div class="saturday">SAT</div>
                </div>
                <!-- æ—¥ä»˜ã‚°ãƒªãƒƒãƒ‰ -->
                <div id="calendar" class="calendar-grid"></div>
            </div>
        </div>

        <!-- ç›®æ¨™ãƒ»èª²é¡Œç‚¹ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="font-bold text-gray-800 flex items-center"><span class="mr-2 text-blue-500">â—</span>ä»Šæœˆã®ç›®æ¨™</h2>
                    <button id="editGoalBtn" class="text-xs font-bold text-blue-500 hover:bg-blue-50 px-3 py-1 rounded-full">ç·¨é›†</button>
                </div>
                <div id="goalDisplay" class="text-sm text-gray-600 bg-gray-50 p-4 rounded-2xl min-h-[100px] whitespace-pre-wrap"></div>
            </div>
            <div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="font-bold text-gray-800 flex items-center"><span class="mr-2 text-orange-500">â—</span>èª²é¡Œãƒ»æ”¹å–„ç‚¹</h2>
                    <button id="editIssueBtn" class="text-xs font-bold text-blue-500 hover:bg-blue-50 px-3 py-1 rounded-full">ç·¨é›†</button>
                </div>
                <div id="issueDisplay" class="text-sm text-gray-600 bg-gray-50 p-4 rounded-2xl min-h-[100px] whitespace-pre-wrap"></div>
            </div>
        </div>

        <!-- TODOãƒªã‚¹ãƒˆ -->
        <div class="space-y-4">
            <div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-100">
                <h2 class="font-bold text-gray-800 mb-4 flex items-center"><span class="mr-2 text-green-500">â—</span>æœªå®Œäº†ã®ã‚„ã‚‹ã“ã¨</h2>
                <div id="incompleteTodos" class="space-y-2"></div>
            </div>
            <div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-100">
                <h2 class="font-bold text-gray-400 mb-4 flex items-center"><span class="mr-2 text-gray-300">â—</span>å®Œäº†æ¸ˆã¿ã®ã‚„ã‚‹ã“ã¨</h2>
                <div id="completedTodos" class="space-y-2 opacity-60"></div>
            </div>
        </div>

        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± -->
        <div class="text-center py-8">
            <p class="text-[10px] font-bold text-gray-400 uppercase mb-2">Login User ID</p>
            <p id="userIdDisplay" class="font-mono text-[10px] text-gray-400 break-all px-4"></p>
        </div>
    </div>

    <!-- äºˆå®šå…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="modal" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-[40px] p-8 w-full max-w-md shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 id="modalDate" class="text-xl font-black text-gray-800"></h2>
                <button id="closeModalBtn" class="text-gray-400 hover:text-gray-600 text-3xl">&times;</button>
            </div>
            <div class="space-y-6">
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-2">äºˆå®šå†…å®¹</label>
                    <div class="flex gap-2">
                        <input id="eventInput" class="flex-1 bg-gray-50 border-none rounded-2xl p-4 focus:ring-2 focus:ring-blue-500 outline-none text-sm" placeholder="ä¾‹ï¼šä¼šè­°ã€æ—…è¡Œãªã©">
                        <input type="color" id="eventColor" class="w-12 h-12 rounded-2xl border-none p-1 bg-gray-50 cursor-pointer">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-2">TODOã‚’è¿½åŠ </label>
                    <div class="flex gap-2">
                        <input id="newTodoInput" class="flex-1 bg-gray-50 border-none rounded-2xl p-4 focus:ring-2 focus:ring-blue-500 outline-none text-sm" placeholder="ã‚„ã‚‹ã“ã¨ã‚’å…¥åŠ›...">
                        <button id="addTodoBtn" class="bg-blue-600 text-white px-6 rounded-2xl font-bold hover:bg-blue-700 transition-all">è¿½åŠ </button>
                    </div>
                </div>
                <div id="modalTodoList" class="space-y-2 max-h-40 overflow-y-auto pr-2"></div>
                <button id="saveBtn" class="w-full bg-gray-900 text-white py-4 rounded-2xl font-bold hover:bg-black transition-all">ä¿å­˜ã—ã¦é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- ç›®æ¨™ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="notesModal" class="fixed inset-0 bg-black/40 backdrop-blur-sm hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-[40px] p-8 w-full max-w-md shadow-2xl">
            <h2 id="notesModalTitle" class="text-xl font-black text-gray-800 mb-6"></h2>
            <textarea id="notesInput" class="w-full h-48 bg-gray-50 border-none rounded-2xl p-4 focus:ring-2 focus:ring-blue-500 outline-none text-sm mb-6" placeholder="å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
            <div class="flex gap-3">
                <button id="cancelNotesBtn" class="flex-1 bg-gray-100 text-gray-500 py-4 rounded-2xl font-bold">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button id="saveNotesBtn" class="flex-1 bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-blue-200">ä¿å­˜ã™ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div id="statusMessage" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-gray-900 text-white text-[10px] font-bold py-2 px-6 rounded-full shadow-xl transition-all duration-300 opacity-0 pointer-events-none z-[100]"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase è¨­å®š ---
        const firebaseConfig = {
            apiKey: "AIzaSyD1as9zQr8P6k8Up9Y4FnO3DYroyvgMnAM",
            authDomain: "karennda-e8465.firebaseapp.com",
            projectId: "karennda-e8465",
            storageBucket: "karennda-e8465.firebasestorage.app",
            messagingSenderId: "1023443880200",
            appId: "1:1023443880200:web:ee995edd613fbc626544bd",
            measurementId: "G-E9Y0L9P95V"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'default-calendar';

        // --- ã‚¢ãƒ—ãƒªçŠ¶æ…‹ ---
        let user = null;
        let eventData = {}; // å…¨ã¦ã®æ—¥ç¨‹ãƒ‡ãƒ¼ã‚¿
        let monthlyNotes = { goal: "", issue: "" };
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth();
        let selectedDateKey = null;
        let editingField = null;
        let noteUnsubscribe = null;

        const getMonthKey = () => `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;

        // --- DOM ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ---
        const $ = (id) => document.getElementById(id);
        const showToast = (msg) => {
            const el = $('statusMessage');
            el.textContent = msg;
            el.style.opacity = '1';
            setTimeout(() => el.style.opacity = '0', 2500);
        };

        // --- åˆæœŸåŒ– & èªè¨¼ ---
        const init = async () => {
            try {
                const cred = await signInAnonymously(auth);
                user = cred.user;
                $('userIdDisplay').textContent = user.uid;

                // ã‚¤ãƒ™ãƒ³ãƒˆä¸€æ‹¬è³¼èª­ (å…¨ãƒ‡ãƒ¼ã‚¿å–å¾—ã—ã¦ãƒ¡ãƒ¢ãƒªå†…ã§ãƒ•ã‚£ãƒ«ã‚¿)
                onSnapshot(collection(db, 'artifacts', APP_ID, 'public', 'data', 'calendar_events'), (snap) => {
                    eventData = {};
                    snap.forEach(doc => eventData[doc.id] = doc.data());
                    renderCalendar();
                    renderFooterTodoLists();
                });

                syncNotes(); // æœˆé–“ãƒ¡ãƒ¢ã®è³¼èª­
            } catch (e) {
                console.error(e);
                showToast("èªè¨¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
            }
        };

        // æœˆé–“ãƒ¡ãƒ¢ã®è³¼èª­ç®¡ç† (åˆ‡ã‚Šæ›¿ãˆæ™‚ã«å¤ã„ãƒªã‚¹ãƒŠãƒ¼ã‚’è§£é™¤)
        const syncNotes = () => {
            if (noteUnsubscribe) noteUnsubscribe();
            const monthKey = getMonthKey();
            noteUnsubscribe = onSnapshot(doc(db, 'artifacts', APP_ID, 'public', 'data', 'monthly_notes', monthKey), (snap) => {
                if (snap.exists()) {
                    monthlyNotes = snap.data();
                    $('goalDisplay').textContent = monthlyNotes.goal || "ç›®æ¨™ã‚’è¨­å®šã—ã¾ã—ã‚‡ã†";
                    $('issueDisplay').textContent = monthlyNotes.issue || "èª²é¡Œã‚’æ•´ç†ã—ã¾ã—ã‚‡ã†";
                } else {
                    monthlyNotes = { goal: "", issue: "" };
                    $('goalDisplay').textContent = "ç›®æ¨™ã‚’è¨­å®šã—ã¾ã—ã‚‡ã†";
                    $('issueDisplay').textContent = "èª²é¡Œã‚’æ•´ç†ã—ã¾ã—ã‚‡ã†";
                }
            });
        };

        // --- æç”»ãƒ­ã‚¸ãƒƒã‚¯ ---
        const renderCalendar = () => {
            const calendar = $('calendar');
            calendar.innerHTML = '';
            $('currentMonthYear').textContent = `${currentYear}å¹´ ${currentMonth + 1}æœˆ`;

            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const lastDate = new Date(currentYear, currentMonth + 1, 0).getDate();
            const prevLastDate = new Date(currentYear, currentMonth, 0).getDate();

            // å‰æœˆåˆ†
            for (let i = firstDay; i > 0; i--) {
                calendar.appendChild(createCell(prevLastDate - i + 1, true));
            }
            // å½“æœˆåˆ†
            for (let i = 1; i <= lastDate; i++) {
                calendar.appendChild(createCell(i, false));
            }
            // ç¿Œæœˆåˆ† (6è¡Œå›ºå®š)
            const totalCells = firstDay + lastDate;
            const remaining = 42 - totalCells;
            for (let i = 1; i <= remaining; i++) {
                calendar.appendChild(createCell(i, true));
            }
        };

        const createCell = (day, isOther) => {
            const cell = document.createElement('div');
            cell.className = `day-cell ${isOther ? 'other-month text-slate-300 bg-slate-50/50' : ''}`;
            
            if (!isOther) {
                const dateKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const data = eventData[dateKey] || {};
                const d = new Date(currentYear, currentMonth, day);

                if (d.toDateString() === new Date().toDateString()) cell.classList.add('today');
                if (d.getDay() === 0) cell.classList.add('holiday');
                if (d.getDay() === 6) cell.classList.add('saturday');

                let html = `<div class="day-number">${day}</div><div class="flex-1 space-y-0.5 overflow-hidden">`;
                if (data.event) {
                    const style = data.color ? `style="border-left: 3px solid ${data.color}; background-color: ${data.color}15"` : '';
                    html += `<div class="item-badge event" ${style}>${data.event}</div>`;
                }
                if (data.todos) {
                    data.todos.forEach(t => {
                        html += `<div class="item-badge todo ${t.completed ? 'completed' : ''}">ãƒ»${t.text}</div>`;
                    });
                }
                html += `</div>`;
                cell.innerHTML = html;
                cell.onclick = () => openEditModal(dateKey);
            } else {
                cell.innerHTML = `<div class="day-number opacity-30">${day}</div>`;
            }
            return cell;
        };

        const renderFooterTodoLists = () => {
            const incContainer = $('incompleteTodos');
            const compContainer = $('completedTodos');
            incContainer.innerHTML = '';
            compContainer.innerHTML = '';

            const items = [];
            Object.entries(eventData).forEach(([date, data]) => {
                if (data.todos) {
                    data.todos.forEach((t, i) => items.push({ date, text: t.text, completed: t.completed, index: i }));
                }
            });

            // å½“æœˆåˆ†ã‚’å„ªå…ˆã—ã¦ã‚½ãƒ¼ãƒˆ
            items.sort((a, b) => a.date.localeCompare(b.date));

            items.forEach(item => {
                const day = item.date.split('-')[2];
                const div = document.createElement('div');
                div.className = `flex items-center p-4 rounded-2xl border ${item.completed ? 'bg-white border-gray-100 grayscale' : 'bg-white border-blue-100 shadow-sm'}`;
                div.innerHTML = `
                    <input type="checkbox" ${item.completed ? 'checked' : ''} class="w-5 h-5 rounded-lg border-gray-300 text-blue-600 focus:ring-blue-500 mr-4 transition-all">
                    <div class="flex-1">
                        <p class="text-[10px] font-black text-gray-300 uppercase">${day}æ—¥</p>
                        <p class="text-sm font-bold ${item.completed ? 'line-through text-gray-300' : 'text-gray-700'}">${item.text}</p>
                    </div>
                `;
                div.querySelector('input').onchange = (e) => toggleTodo(item.date, item.index, e.target.checked);
                (item.completed ? compContainer : incContainer).appendChild(div);
            });

            if (incContainer.children.length === 0) incContainer.innerHTML = '<p class="text-gray-300 text-xs italic py-4">ç¾åœ¨ã€æœªå®Œäº†ã®ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ ğŸ‘</p>';
        };

        // --- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ---
        const toggleTodo = async (date, idx, state) => {
            const data = { ...eventData[date] };
            data.todos[idx].completed = state;
            await setDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'calendar_events', date), data);
            showToast(state ? "ã‚¿ã‚¹ã‚¯å®Œäº†ï¼ ğŸ‰" : "ã‚¿ã‚¹ã‚¯ã‚’æˆ»ã—ã¾ã—ãŸ");
        };

        const openEditModal = (dateKey) => {
            selectedDateKey = dateKey;
            const data = eventData[dateKey] || { event: "", color: "#3b82f6", todos: [] };
            $('modalDate').textContent = dateKey.replace(/-/g, ' / ');
            $('eventInput').value = data.event || "";
            $('eventColor').value = data.color || "#3b82f6";
            renderModalTodos(data.todos || []);
            $('modal').classList.replace('hidden', 'flex');
        };

        const renderModalTodos = (todos) => {
            const container = $('modalTodoList');
            container.innerHTML = '';
            todos.forEach((t, i) => {
                const d = document.createElement('div');
                d.className = "flex items-center justify-between bg-gray-50 p-3 rounded-xl";
                d.innerHTML = `<span class="text-sm font-bold ${t.completed ? 'line-through text-gray-400' : 'text-gray-600'}">${t.text}</span>
                               <button class="text-red-300 hover:text-red-500 text-lg font-black">&times;</button>`;
                d.querySelector('button').onclick = () => {
                    todos.splice(i, 1);
                    saveDateData({ todos });
                    renderModalTodos(todos);
                };
                container.appendChild(d);
            });
        };

        const saveDateData = async (overrides) => {
            if (!user) return;
            const data = { ...eventData[selectedDateKey], ...overrides };
            await setDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'calendar_events', selectedDateKey), data);
        };

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
        $('saveBtn').onclick = async () => {
            const event = $('eventInput').value;
            const color = $('eventColor').value;
            await saveDateData({ event, color });
            $('modal').classList.replace('flex', 'hidden');
            showToast("ä¿å­˜ã—ã¾ã—ãŸ");
        };

        $('addTodoBtn').onclick = () => {
            const input = $('newTodoInput');
            const text = input.value.trim();
            if (!text) return;
            const todos = eventData[selectedDateKey]?.todos || [];
            todos.push({ text, completed: false });
            saveDateData({ todos });
            renderModalTodos(todos);
            input.value = '';
        };

        $('editGoalBtn').onclick = () => {
            editingField = 'goal';
            $('notesModalTitle').textContent = "ä»Šæœˆã®ç›®æ¨™ã‚’ç·¨é›†";
            $('notesInput').value = monthlyNotes.goal || "";
            $('notesModal').classList.replace('hidden', 'flex');
        };

        $('editIssueBtn').onclick = () => {
            editingField = 'issue';
            $('notesModalTitle').textContent = "èª²é¡Œãƒ»æ”¹å–„ç‚¹ã‚’ç·¨é›†";
            $('notesInput').value = monthlyNotes.issue || "";
            $('notesModal').classList.replace('hidden', 'flex');
        };

        $('saveNotesBtn').onclick = async () => {
            const text = $('notesInput').value;
            const updated = { ...monthlyNotes, [editingField]: text };
            await setDoc(doc(db, 'artifacts', APP_ID, 'public', 'data', 'monthly_notes', getMonthKey()), updated);
            $('notesModal').classList.replace('flex', 'hidden');
            showToast("æœˆé–“ãƒ¡ãƒ¢ã‚’æ›´æ–°ã—ã¾ã—ãŸ");
        };

        $('cancelNotesBtn').onclick = () => $('notesModal').classList.replace('flex', 'hidden');
        $('closeModalBtn').onclick = () => $('modal').classList.replace('flex', 'hidden');

        $('prevMonthBtn').onclick = () => {
            currentMonth--;
            if (currentMonth < 0) { currentMonth = 11; currentYear--; }
            syncNotes();
            renderCalendar();
        };

        $('nextMonthBtn').onclick = () => {
            currentMonth++;
            if (currentMonth > 11) { currentMonth = 0; currentYear++; }
            syncNotes();
            renderCalendar();
        };

        // è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        $('mobileViewBtn').onclick = () => {
            document.body.className = "p-2 mobile-layout";
            $('mobileViewBtn').className = "px-4 py-2 text-sm font-bold rounded-full border bg-blue-600 text-white border-blue-600 shadow-sm";
            $('pcViewBtn').className = "px-4 py-2 text-sm font-bold rounded-full border bg-white text-gray-600 border-gray-200";
        };
        $('pcViewBtn').onclick = () => {
            document.body.className = "p-4 pc-layout";
            $('pcViewBtn').className = "px-4 py-2 text-sm font-bold rounded-full border bg-blue-600 text-white border-blue-600 shadow-sm";
            $('mobileViewBtn').className = "px-4 py-2 text-sm font-bold rounded-full border bg-white text-gray-600 border-gray-200";
        };

        init();
    </script>
</body>
</html>
