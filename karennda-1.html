<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ»</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #f8fafc;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }
        .day-cell {
            min-height: 120px;
            border: 1px solid #f1f5f9;
            padding: 6px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            background-color: white;
        }
        .day-cell.prev-month, .day-cell.next-month {
            color: #cbd5e1;
            background-color: #f8fafc;
        }
        .day-cell:not(.prev-month):not(.next-month):hover {
            background-color: #f1f7ff;
            z-index: 10;
            box-shadow: inset 0 0 0 2px #3b82f6;
        }
        .day-number {
            font-size: 1rem;
            font-weight: 800;
            margin-bottom: 4px;
        }
        .day-cell.today {
            background-color: #eff6ff;
            box-shadow: inset 0 0 0 2px #3b82f6;
        }
        .holiday { color: #ef4444; }
        .saturday { color: #3b82f6; }
        
        /* äºˆå®šã¨TODOã®ãƒ†ã‚­ã‚¹ãƒˆåˆ¶å¾¡ */
        .event-item {
            font-size: 0.7rem;
            line-height: 1.3;
            padding: 2px 4px;
            border-radius: 4px;
            margin-bottom: 3px;
            /* 10æ–‡å­—ç¨‹åº¦ã§æ”¹è¡Œã•ã›ã‚‹ãŸã‚ã®åˆ¶å¾¡ */
            word-break: break-all;
            overflow-wrap: break-word;
            display: block;
            max-width: 100%;
        }
        .event-item.event {
            background-color: #e2e8f0;
            color: #1e293b;
            font-weight: 600;
        }
        .todo-item {
            color: #065f46;
            background-color: #dcfce7;
            font-weight: 500;
        }
        
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ã®åŒæœŸè¨­å®š */
        .calendar-scroll-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* ã‚¹ãƒãƒ›è¡¨ç¤ºç”¨ã®æ¨ªå¹…ç¢ºä¿ */
        .mobile-layout .calendar-grid-container {
            min-width: 800px; /* ååˆ†ãªæ¨ªå¹…ã‚’ç¢ºä¿ã—ã¦æ›œæ—¥ã¨åˆ—ã‚’å›ºå®š */
        }
        .mobile-layout .day-cell {
            min-height: 100px;
        }
        
        /* PCè¡¨ç¤ºç”¨ */
        .pc-layout .main-container {
            max-width: 1200px;
        }
        
        .main-container {
            width: 100%;
            margin: 0 auto;
        }

        /* æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .weekday-header {
            text-align: center;
            font-weight: 800;
            background-color: #f1f5f9;
            color: #64748b;
            padding: 12px 0;
            font-size: 0.8rem;
            border-bottom: 1px solid #e2e8f0;
        }
    </style>
</head>
<body class="p-2 sm:p-6 pc-layout">
    <!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ -->
    <div class="flex justify-center mb-6 space-x-2">
        <button id="mobileViewBtn" class="px-5 py-2 rounded-xl text-sm font-bold transition-all border border-gray-200 bg-white text-gray-600 hover:bg-gray-50">ã‚¹ãƒãƒ›è¡¨ç¤º</button>
        <button id="pcViewBtn" class="px-5 py-2 rounded-xl text-sm font-bold transition-all bg-blue-600 text-white shadow-lg shadow-blue-200">PCè¡¨ç¤º</button>
    </div>

    <div id="appContainer" class="main-container space-y-6">
        
        <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚«ãƒ¼ãƒ‰ -->
        <div class="bg-white rounded-3xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="p-4 sm:p-6 flex items-center justify-between bg-white">
                <h1 class="text-3xl">ğŸŒ»</h1>
                <div class="flex items-center space-x-4">
                    <button id="prevMonthBtn" class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 rounded-full text-xl font-bold">â€¹</button>
                    <span id="currentMonthYear" class="text-xl font-black text-gray-800 tracking-tighter"></span>
                    <button id="nextMonthBtn" class="w-10 h-10 flex items-center justify-center hover:bg-gray-100 rounded-full text-xl font-bold">â€º</button>
                </div>
            </div>

            <!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãªã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¨ãƒªã‚¢ -->
            <div class="calendar-scroll-wrapper">
                <div class="calendar-grid-container">
                    <!-- æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæœ¬ä½“ã¨ä¸€ç·’ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰ -->
                    <div class="calendar-grid">
                        <div class="weekday-header holiday">æ—¥</div>
                        <div class="weekday-header">æœˆ</div>
                        <div class="weekday-header">ç«</div>
                        <div class="weekday-header">æ°´</div>
                        <div class="weekday-header">æœ¨</div>
                        <div class="weekday-header">é‡‘</div>
                        <div class="weekday-header saturday">åœŸ</div>
                    </div>
                    <!-- æ—¥ä»˜ã‚°ãƒªãƒƒãƒ‰ -->
                    <div id="calendar" class="calendar-grid"></div>
                </div>
            </div>
        </div>
        
        <!-- ç›®æ¨™ãƒ»èª²é¡Œç‚¹ -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-black text-gray-800 flex items-center"><span class="text-xl mr-2">ğŸ¯</span>ç›®æ¨™</h2>
                    <button id="editGoalBtn" class="text-blue-600 font-bold text-sm">ç·¨é›†</button>
                </div>
                <div id="goalDisplay" class="text-gray-600 text-sm leading-relaxed whitespace-pre-wrap min-h-[80px] p-4 bg-gray-50 rounded-2xl border border-dashed border-gray-200"></div>
            </div>

            <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="font-black text-gray-800 flex items-center"><span class="text-xl mr-2">ğŸ’¡</span>èª²é¡Œç‚¹</h2>
                    <button id="editIssueBtn" class="text-blue-600 font-bold text-sm">ç·¨é›†</button>
                </div>
                <div id="issueDisplay" class="text-gray-600 text-sm leading-relaxed whitespace-pre-wrap min-h-[80px] p-4 bg-gray-50 rounded-2xl border border-dashed border-gray-200"></div>
            </div>
        </div>

        <!-- æœªå®Œäº†TODO -->
        <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100">
            <h2 class="font-black text-gray-800 mb-4 flex items-center"><span class="text-xl mr-2">ğŸ”¥</span>æœªå®Œäº†ã®ã‚„ã‚‹ã“ã¨</h2>
            <div id="incompleteTodos" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
        </div>

        <!-- å®Œäº†æ¸ˆTODO -->
        <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-100">
            <h2 class="font-black text-gray-800 mb-4 flex items-center"><span class="text-xl mr-2">ğŸ’</span>å®Œäº†æ¸ˆã¿ã®ã‚„ã‚‹ã“ã¨</h2>
            <div id="completedTodos" class="grid grid-cols-1 sm:grid-cols-2 gap-3"></div>
        </div>

        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± -->
        <div class="p-4 text-center">
            <p class="text-[10px] text-gray-400 font-bold uppercase tracking-widest mb-1">Authenticated ID</p>
            <p id="userIdDisplay" class="font-mono text-[10px] text-gray-300 break-all"></p>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ»ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ç³» -->
    <div id="modal" class="fixed inset-0 bg-slate-900/40 hidden items-center justify-center p-4 z-50 backdrop-blur-md">
        <div class="bg-white rounded-[40px] p-8 w-full max-w-md shadow-2xl animate-in zoom-in duration-200">
            <div class="flex justify-between items-center mb-6">
                <h2 id="modalDate" class="text-2xl font-black text-slate-800"></h2>
                <button id="closeModalBtn" class="text-slate-300 hover:text-slate-600 text-3xl">&times;</button>
            </div>
            
            <div class="space-y-5">
                <div>
                    <label class="block text-xs font-black text-slate-400 mb-2 uppercase">Schedule</label>
                    <div class="flex gap-3">
                        <textarea id="eventInput" class="flex-1 h-24 p-4 bg-slate-50 border-0 rounded-3xl focus:ring-2 focus:ring-blue-500 outline-none text-sm font-medium" placeholder="ä»Šæ—¥ã®äºˆå®šã¯ï¼Ÿ"></textarea>
                        <input type="color" id="eventColor" class="w-14 h-24 rounded-3xl border-0 p-1 cursor-pointer bg-slate-50" value="#3b82f6">
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-black text-slate-400 mb-2 uppercase">New Task</label>
                    <div class="flex gap-2">
                        <input type="text" id="newTodoInput" class="flex-1 p-4 bg-slate-50 border-0 rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none text-sm font-medium" placeholder="ã‚„ã‚‹ã“ã¨ã‚’è¿½åŠ ...">
                        <button id="addTodoBtn" class="bg-slate-800 text-white px-6 rounded-2xl font-black hover:bg-slate-700 transition-colors text-sm">ADD</button>
                    </div>
                </div>

                <div id="todoList" class="space-y-2 max-h-48 overflow-y-auto pr-2"></div>

                <button id="saveBtn" class="w-full bg-blue-600 text-white py-4 rounded-3xl font-black text-lg shadow-lg shadow-blue-100 hover:bg-blue-700 transition-transform active:scale-[0.98]">ä¿å­˜ã™ã‚‹</button>
            </div>
        </div>
    </div>

    <div id="notesModal" class="fixed inset-0 bg-slate-900/40 hidden items-center justify-center p-4 z-50 backdrop-blur-md">
        <div class="bg-white rounded-[40px] p-8 w-full max-w-md shadow-2xl animate-in zoom-in duration-200">
            <h2 id="notesModalTitle" class="text-2xl font-black text-slate-800 mb-6"></h2>
            <textarea id="notesInput" class="w-full h-48 p-4 bg-slate-50 border-0 rounded-3xl focus:ring-2 focus:ring-blue-500 outline-none text-sm font-medium mb-6"></textarea>
            <div class="flex gap-3">
                <button id="cancelNotesBtn" class="flex-1 bg-slate-100 text-slate-500 py-4 rounded-3xl font-black">æˆ»ã‚‹</button>
                <button id="saveNotesBtn" class="flex-1 bg-slate-800 text-white py-4 rounded-3xl font-black shadow-lg shadow-slate-200">ä¿å­˜</button>
            </div>
        </div>
    </div>
    
    <div id="statusMessage" class="fixed top-6 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-[10px] font-bold py-2 px-6 rounded-full shadow-2xl transition-all duration-300 translate-y-[-100%] opacity-0 z-[100]"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD1as9zQr8P6k8Up9Y4FnO3DYroyvgMnAM",
            authDomain: "karennda-e8465.firebaseapp.com",
            projectId: "karennda-e8465",
            storageBucket: "karennda-e8465.firebasestorage.app",
            messagingSenderId: "1023443880200",
            appId: "1:1023443880200:web:ee995edd613fbc626544bd",
            measurementId: "G-E9Y0L9P95V"
        };
        
        const appId = 'karennda-v1';
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let currentUserId = null;
        let eventData = {};
        let monthlyNotes = {};
        let currentYear = new Date().getFullYear();
        let currentMonth = new Date().getMonth();
        let selectedDate = null;
        let currentEditingField = null;

        const elements = {
            calendar: document.getElementById('calendar'),
            monthYear: document.getElementById('currentMonthYear'),
            userId: document.getElementById('userIdDisplay'),
            goal: document.getElementById('goalDisplay'),
            issue: document.getElementById('issueDisplay'),
            incomplete: document.getElementById('incompleteTodos'),
            completed: document.getElementById('completedTodos'),
            status: document.getElementById('statusMessage'),
            modal: document.getElementById('modal'),
            notesModal: document.getElementById('notesModal')
        };

        const currentYearMonth = () => `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;

        const showStatus = (msg) => {
            elements.status.textContent = msg;
            elements.status.style.transform = 'translateY(0)';
            elements.status.style.opacity = '1';
            setTimeout(() => {
                elements.status.style.transform = 'translateY(-100%)';
                elements.status.style.opacity = '0';
            }, 2500);
        };

        const initSync = async () => {
            try {
                const cred = await signInAnonymously(auth);
                currentUserId = cred.user.uid;
                elements.userId.textContent = currentUserId;
                
                // å…¨ãƒ‡ãƒ¼ã‚¿ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
                onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'calendar_events'), (snap) => {
                    eventData = {};
                    snap.forEach(doc => eventData[doc.id] = doc.data());
                    renderAll();
                });

                syncMonthlyNotes();
            } catch (err) {
                console.error(err);
            }
        };

        const syncMonthlyNotes = () => {
            const noteId = currentYearMonth();
            onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'monthly_notes', noteId), (d) => {
                if (d.exists()) {
                    monthlyNotes = d.data();
                    elements.goal.textContent = monthlyNotes.goal || "ä»Šæœˆã®ç›®æ¨™ã‚’æ±ºã‚ã¾ã—ã‚‡ã†";
                    elements.issue.textContent = monthlyNotes.issue || "èª²é¡Œã‚’æ›¸ãå‡ºã—ã¾ã—ã‚‡ã†";
                } else {
                    monthlyNotes = { goal: "", issue: "" };
                    elements.goal.textContent = "ä»Šæœˆã®ç›®æ¨™ã‚’æ±ºã‚ã¾ã—ã‚‡ã†";
                    elements.issue.textContent = "èª²é¡Œã‚’æ›¸ãå‡ºã—ã¾ã—ã‚‡ã†";
                }
            });
        };

        const renderAll = () => {
            elements.calendar.innerHTML = '';
            elements.monthYear.textContent = `${currentYear}å¹´ ${currentMonth + 1}æœˆ`;

            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const lastDate = new Date(currentYear, currentMonth + 1, 0).getDate();
            const prevLastDate = new Date(currentYear, currentMonth, 0).getDate();

            for (let i = firstDay; i > 0; i--) createCell(prevLastDate - i + 1, true);
            for (let i = 1; i <= lastDate; i++) createCell(i, false);
            const remaining = 42 - (firstDay + lastDate);
            for (let i = 1; i <= remaining; i++) createCell(i, true);

            renderGlobalTodoLists();
        };

        const createCell = (day, isOther) => {
            const cell = document.createElement('div');
            cell.className = `day-cell ${isOther ? 'prev-month' : ''}`;
            
            if (!isOther) {
                const dateKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const data = eventData[dateKey] || {};
                const dateObj = new Date(currentYear, currentMonth, day);
                
                if (dateObj.toDateString() === new Date().toDateString()) cell.classList.add('today');
                if (dateObj.getDay() === 0) cell.classList.add('holiday');
                if (dateObj.getDay() === 6) cell.classList.add('saturday');

                let html = `<div class="day-number">${day}</div>`;
                if (data.event) {
                    const bg = data.color ? data.color + '15' : '#f1f5f9';
                    const border = data.color || '#cbd5e1';
                    html += `<div class="event-item event" style="background-color:${bg}; border-left: 3px solid ${border}">${data.event}</div>`;
                }
                if (data.todos) {
                    data.todos.filter(t => !t.completed).forEach(t => {
                        html += `<div class="event-item todo-item">ãƒ» ${t.text}</div>`;
                    });
                }
                cell.innerHTML = html;
                cell.onclick = () => openModal(dateKey);
            } else {
                cell.innerHTML = `<div class="day-number opacity-10">${day}</div>`;
            }
            elements.calendar.appendChild(cell);
        };

        const renderGlobalTodoLists = () => {
            elements.incomplete.innerHTML = '';
            elements.completed.innerHTML = '';
            
            const inc = [];
            const com = [];

            Object.entries(eventData).forEach(([date, data]) => {
                if (!data.todos) return;
                const day = date.split('-')[2];
                data.todos.forEach((t, i) => {
                    const o = { date, day, text: t.text, i };
                    if (t.completed) com.push(o); else inc.push(o);
                });
            });

            const createTodo = (item, isDone) => {
                const d = document.createElement('div');
                d.className = `flex items-center p-4 rounded-2xl shadow-sm border ${isDone ? 'bg-slate-50 border-slate-100 grayscale opacity-60' : 'bg-white border-slate-100 hover:scale-[1.01] transition-transform'}`;
                d.innerHTML = `
                    <input type="checkbox" ${isDone ? 'checked' : ''} class="w-6 h-6 rounded-lg border-slate-200 text-blue-600 focus:ring-blue-500 mr-4 cursor-pointer">
                    <div class="flex-1">
                        <span class="text-[10px] font-black text-slate-300 block mb-1">${item.day}æ—¥</span>
                        <span class="text-sm ${isDone ? 'line-through text-slate-400' : 'text-slate-700 font-bold'}">${item.text}</span>
                    </div>
                `;
                d.querySelector('input').onchange = (e) => toggleTodo(item.date, item.i, e.target.checked);
                return d;
            };

            inc.sort((a,b)=>a.date.localeCompare(b.date)).forEach(x => elements.incomplete.appendChild(createTodo(x, false)));
            com.sort((a,b)=>a.date.localeCompare(b.date)).forEach(x => elements.completed.appendChild(createTodo(x, true)));
            
            if (!inc.length) elements.incomplete.innerHTML = '<p class="text-slate-300 text-sm font-bold italic p-4">âœ¨ å®Œç’§ã§ã™ï¼</p>';
            if (!com.length) elements.completed.innerHTML = '<p class="text-slate-300 text-sm font-bold italic p-4">ã¾ã å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
        };

        const openModal = (dateKey) => {
            selectedDate = dateKey;
            const data = eventData[dateKey] || { event: "", color: "#3b82f6", todos: [] };
            document.getElementById('modalDate').textContent = dateKey.replace(/-/g, '.');
            document.getElementById('eventInput').value = data.event || "";
            document.getElementById('eventColor').value = data.color || "#3b82f6";
            renderModalTodos(data.todos || []);
            elements.modal.classList.replace('hidden', 'flex');
        };

        const renderModalTodos = (todos) => {
            const list = document.getElementById('todoList');
            list.innerHTML = '';
            todos.forEach((t, i) => {
                const d = document.createElement('div');
                d.className = "flex items-center space-x-3 bg-slate-50 p-3 rounded-2xl";
                d.innerHTML = `
                    <span class="flex-1 text-xs font-bold ${t.completed ? 'line-through text-slate-400' : 'text-slate-600'}">${t.text}</span>
                    <button class="text-rose-400 hover:text-rose-600 font-black text-xs uppercase">DEL</button>
                `;
                d.querySelector('button').onclick = () => {
                    todos.splice(i, 1);
                    saveData({ todos });
                    renderModalTodos(todos);
                };
                list.appendChild(d);
            });
        };

        const saveData = async (overrides) => {
            if (!currentUserId) return;
            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'calendar_events', selectedDate);
            const current = eventData[selectedDate] || {};
            await setDoc(docRef, { ...current, ...overrides });
        };

        const toggleTodo = async (date, i, state) => {
            const d = eventData[date];
            d.todos[i].completed = state;
            await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'calendar_events', date), d);
            showStatus(state ? "GOOD JOB! ğŸ’" : "RESTORED");
        };

        // ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
        document.getElementById('saveBtn').onclick = async () => {
            const event = document.getElementById('eventInput').value;
            const color = document.getElementById('eventColor').value;
            await saveData({ event, color });
            elements.modal.classList.replace('flex', 'hidden');
            showStatus("SAVED");
        };

        document.getElementById('addTodoBtn').onclick = () => {
            const input = document.getElementById('newTodoInput');
            const text = input.value.trim();
            if (!text) return;
            const todos = eventData[selectedDate]?.todos || [];
            todos.push({ text, completed: false });
            saveData({ todos });
            renderModalTodos(todos);
            input.value = '';
        };

        document.getElementById('editGoalBtn').onclick = () => {
            currentEditingField = 'goal';
            document.getElementById('notesModalTitle').textContent = "ä»Šæœˆã®ç›®æ¨™";
            document.getElementById('notesInput').value = monthlyNotes.goal || "";
            elements.notesModal.classList.replace('hidden', 'flex');
        };

        document.getElementById('editIssueBtn').onclick = () => {
            currentEditingField = 'issue';
            document.getElementById('notesModalTitle').textContent = "ä»Šæœˆã®èª²é¡Œ";
            document.getElementById('notesInput').value = monthlyNotes.issue || "";
            elements.notesModal.classList.replace('hidden', 'flex');
        };

        document.getElementById('saveNotesBtn').onclick = async () => {
            const text = document.getElementById('notesInput').value;
            const updated = { ...monthlyNotes, [currentEditingField]: text };
            await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'monthly_notes', currentYearMonth()), updated);
            elements.notesModal.classList.replace('flex', 'hidden');
            showStatus("UPDATED");
        };

        document.getElementById('cancelNotesBtn').onclick = () => elements.notesModal.classList.replace('flex', 'hidden');
        document.getElementById('closeModalBtn').onclick = () => elements.modal.classList.replace('flex', 'hidden');

        document.getElementById('prevMonthBtn').onclick = () => {
            currentMonth--;
            if (currentMonth < 0) { currentMonth = 11; currentYear--; }
            syncMonthlyNotes();
            renderAll();
        };

        document.getElementById('nextMonthBtn').onclick = () => {
            currentMonth++;
            if (currentMonth > 11) { currentMonth = 0; currentYear++; }
            syncMonthlyNotes();
            renderAll();
        };

        const switchView = (isMobile) => {
            document.body.className = isMobile ? 'p-2 sm:p-4 mobile-layout' : 'p-2 sm:p-6 pc-layout';
            const mBtn = document.getElementById('mobileViewBtn');
            const pBtn = document.getElementById('pcViewBtn');
            
            if(isMobile) {
                mBtn.className = "px-5 py-2 rounded-xl text-sm font-bold bg-blue-600 text-white shadow-lg shadow-blue-200";
                pBtn.className = "px-5 py-2 rounded-xl text-sm font-bold border border-gray-200 bg-white text-gray-600";
            } else {
                pBtn.className = "px-5 py-2 rounded-xl text-sm font-bold bg-blue-600 text-white shadow-lg shadow-blue-200";
                mBtn.className = "px-5 py-2 rounded-xl text-sm font-bold border border-gray-200 bg-white text-gray-600";
            }
            renderAll();
        };

        document.getElementById('mobileViewBtn').onclick = () => switchView(true);
        document.getElementById('pcViewBtn').onclick = () => switchView(false);

        initSync();
    </script>
</body>
</html>
